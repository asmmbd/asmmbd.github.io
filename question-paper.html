<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>মাদ্রাসা পরীক্ষার প্রশ্ন প্রণয়ন সিস্টেম</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        body {
            font-family: 'Hind Siliguri', sans-serif;
        }
        .arabic {
            direction: rtl;
            font-family: 'Traditional Arabic', 'Lateef', 'Hind Siliguri', sans-serif;
            font-size: 1.2em;
            line-height: 1.8;
        }
        .question-paper {
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M30,10 L10,10 L10,30" fill="none" stroke="%23e5e7eb" stroke-width="0.5"/><path d="M70,10 L90,10 L90,30" fill="none" stroke="%23e5e7eb" stroke-width="0.5"/><path d="M30,90 L10,90 L10,70" fill="none" stroke="%23e5e7eb" stroke-width="0.5"/><path d="M70,90 L90,90 L90,70" fill="none" stroke="%23e5e7eb" stroke-width="0.5"/></svg>');
            background-size: 100px 100px;
        }
    </style>
</head>
<body class="bg-gray-50" x-data="app()" x-init="init()" x-cloak>
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center text-green-800 mb-2">মাদ্রাসা পরীক্ষার প্রশ্ন প্রণয়ন সিস্টেম</h1>
        <p class="text-center text-gray-600 mb-8">ইসলামিক ফাউন্ডেশন বাংলাদেশ অনুমোদিত</p>
        
        <!-- ক্লাস ও বিষয় নির্বাচন -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8 border border-green-100">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2 border-green-200">পরীক্ষার তথ্য</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ক্লাস নির্বাচন করুন</label>
                    <select x-model="selectedClass" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" @change="loadSubjects()">
                        <option value="">ক্লাস নির্বাচন করুন</option>
                        <template x-for="cls in classes" :key="cls">
                            <option x-text="cls" :value="cls"></option>
                        </template>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">বিষয় নির্বাচন করুন</label>
                    <select x-model="selectedSubject" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        <option value="">বিষয় নির্বাচন করুন</option>
                        <template x-for="subject in subjects" :key="subject">
                            <option x-text="subject" :value="subject"></option>
                        </template>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">পরীক্ষার নাম</label>
                    <input type="text" x-model="examName" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="মধ্যবর্তী/বার্ষিক পরীক্ষা">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">পরীক্ষার তারিখ</label>
                    <input type="date" x-model="examDate" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">সময়</label>
                    <input type="text" x-model="examDuration" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="২ ঘন্টা ৩০ মিনিট">
                </div>
            </div>
        </div>

        <!-- প্রশ্ন ব্যাংক ও নির্বাচিত প্রশ্ন -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- প্রশ্ন ব্যাংক -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2 border border-green-100">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2 border-green-200">প্রশ্ন ব্যাংক</h2>
                <div class="mb-4 flex flex-col md:flex-row md:justify-between md:items-center gap-3">
                    <div class="flex flex-col md:flex-row gap-2 w-full md:w-auto">
                        <select x-model="filterType" class="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <option value="all">সকল প্রশ্ন</option>
                            <option value="mcq">এমসিকিউ</option>
                            <option value="written">লিখিত</option>
                        </select>
                        <select x-model="filterChapter" class="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <option value="">সকল অধ্যায়</option>
                            <template x-for="chapter in chapters" :key="chapter">
                                <option x-text="chapter" :value="chapter"></option>
                            </template>
                        </select>
                        <input type="text" x-model="searchQuery" placeholder="প্রশ্ন খুঁজুন..." class="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    </div>
                    <button @click="showAddQuestionModal = true" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                        </svg>
                        নতুন প্রশ্ন যোগ
                    </button>
                </div>

                <div class="space-y-4">
                    <template x-for="(question, index) in filteredQuestions" :key="question.id">
                        <div class="border border-gray-200 rounded-md p-4 hover:bg-gray-50 transition-colors duration-200">
                            <div class="flex justify-between items-start gap-3">
                                <div class="flex-1">
                                    <div class="font-medium" x-html="formatQuestionText(question.text)"></div>
                                    <div class="text-sm text-gray-500 mt-1 flex flex-wrap gap-2">
                                        <span class="px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full" x-text="question.type === 'mcq' ? 'এমসিকিউ' : 'লিখিত'"></span>
                                        <span class="px-2 py-0.5 bg-green-100 text-green-800 rounded-full" x-text="'মান: ' + question.marks"></span>
                                        <span x-show="question.chapter" class="px-2 py-0.5 bg-purple-100 text-purple-800 rounded-full" x-text="question.chapter"></span>
                                    </div>
                                    <div x-show="question.options && question.options.length > 0" class="mt-2 ml-4 space-y-1">
                                        <template x-for="(option, optIndex) in question.options" :key="optIndex">
                                            <div class="text-sm" x-text="String.fromCharCode(97 + optIndex) + ') ' + option"></div>
                                        </template>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-2">
                                    <button @click="addToSelected(question)" class="text-green-600 hover:text-green-800" title="যোগ করুন">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                    <button @click="editQuestion(question)" class="text-blue-600 hover:text-blue-800" title="সম্পাদন করুন">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                    <template x-if="filteredQuestions.length === 0">
                        <div class="text-center py-8 text-gray-500 bg-gray-50 rounded-lg">
                            কোন প্রশ্ন পাওয়া যায়নি। নতুন প্রশ্ন যোগ করুন।
                        </div>
                    </template>
                </div>
            </div>

            <!-- নির্বাচিত প্রশ্ন -->
            <div class="bg-white p-6 rounded-lg shadow-md border border-green-100">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2 border-green-200">নির্বাচিত প্রশ্ন</h2>
                <div class="mb-4 flex justify-between items-center bg-green-50 p-3 rounded-md">
                    <span class="text-sm font-medium" x-text="'মোট প্রশ্ন: ' + selectedQuestions.length"></span>
                    <span class="text-sm font-medium" x-text="'মোট মান: ' + totalMarks"></span>
                </div>

                <div class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                    <template x-for="(question, index) in selectedQuestions" :key="question.id">
                        <div class="border border-gray-200 rounded-md p-3 flex justify-between items-center hover:bg-gray-50 transition-colors duration-200">
                            <div class="flex-1">
                                <span class="text-sm" x-text="(index + 1) + '. ' + question.text"></span>
                                <div class="text-xs text-gray-500 mt-1 flex gap-2">
                                    <span x-text="question.type === 'mcq' ? 'এমসিকিউ' : 'লিখিত'"></span> | 
                                    <span x-text="'মান: ' + question.marks"></span>
                                    <span x-show="question.chapter" x-text="' | ' + question.chapter"></span>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button @click="moveQuestionUp(index)" class="text-gray-500 hover:text-gray-700" title="উপরে নিন">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                                <button @click="moveQuestionDown(index)" class="text-gray-500 hover:text-gray-700" title="নিচে নিন">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                                <button @click="removeFromSelected(index)" class="text-red-500 hover:text-red-700" title="মুছুন">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </template>
                    <template x-if="selectedQuestions.length === 0">
                        <div class="text-center py-8 text-gray-500 bg-gray-50 rounded-lg">
                            কোন প্রশ্ন নির্বাচন করা হয়নি।
                        </div>
                    </template>
                </div>

                <div class="mt-6 space-y-3">
                    <button @click="generateQuestionPaper" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z" clip-rule="evenodd" />
                        </svg>
                        প্রশ্নপত্র তৈরি করুন
                    </button>
                    <button @click="saveQuestionSet" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z" />
                        </svg>
                        প্রশ্ন সেট সংরক্ষণ
                    </button>
                    <button @click="showSavedSetsModal = true" class="w-full bg-gray-600 text-white py-2 rounded-md hover:bg-gray-700 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        সংরক্ষিত প্রশ্ন সেট
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- নতুন প্রশ্ন যোগ/সম্পাদনা করার মোডাল -->
    <div x-show="showAddQuestionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" x-transition>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto" @click.away="showAddQuestionModal = false">
            <div class="p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4" x-text="editingQuestion ? 'প্রশ্ন সম্পাদনা করুন' : 'নতুন প্রশ্ন যোগ করুন'"></h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">প্রশ্নের ধরন</label>
                        <select x-model="newQuestion.type" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <option value="written">লিখিত</option>
                            <option value="mcq">এমসিকিউ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">প্রশ্ন</label>
                        <textarea x-model="newQuestion.text" rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="প্রশ্ন লিখুন..."></textarea>
                    </div>
                    
                    <div x-show="newQuestion.type === 'mcq'">
                        <label class="block text-sm font-medium text-gray-700 mb-1">এমসিকিউ অপশন</label>
                        <div class="space-y-2">
                            <template x-for="(option, index) in newQuestion.options" :key="index">
                                <div class="flex items-center">
                                    <input x-model="newQuestion.options[index]" type="text" class="flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" :placeholder="'অপশন ' + (index + 1)">
                                    <button @click="removeMcqOption(index)" class="ml-2 text-red-500 hover:text-red-700">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                </div>
                            </template>
                            <button @click="addMcqOption" class="text-sm text-blue-600 hover:text-blue-800 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                                </svg>
                                অপশন যোগ করুন
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">মান</label>
                            <input x-model="newQuestion.marks" type="number" min="1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="প্রশ্নের মান">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">অধ্যায়</label>
                            <input x-model="newQuestion.chapter" type="text" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="অধ্যায়ের নাম" list="chaptersList">
                            <datalist id="chaptersList">
                                <template x-for="chapter in chapters" :key="chapter">
                                    <option x-text="chapter" :value="chapter"></option>
                                </template>
                            </datalist>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button @click="showAddQuestionModal = false" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        বাতিল করুন
                    </button>
                    <button @click="saveNewQuestion" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                        <span x-text="editingQuestion ? 'আপডেট করুন' : 'সংরক্ষণ করুন'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- সংরক্ষিত প্রশ্ন সেট মোডাল -->
    <div x-show="showSavedSetsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" x-transition>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto" @click.away="showSavedSetsModal = false">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">সংরক্ষিত প্রশ্ন সেট</h3>
                    <button @click="showImportModal = true" class="text-sm bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700">
                        ইম্পোর্ট করুন
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">নাম</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ক্লাস</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">বিষয়</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">প্রশ্ন সংখ্যা</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">মোট মান</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">তারিখ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ক্রিয়া</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="(set, index) in savedQuestionSets" :key="index">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="set.name"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="set.class"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="set.subject"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="set.questions.length"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="set.totalMarks"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="new Date(set.createdAt).toLocaleDateString('bn-BD')"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <div class="flex space-x-2">
                                            <button @click="loadQuestionSet(set)" class="text-blue-600 hover:text-blue-800" title="লোড করুন">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                                </svg>
                                            </button>
                                            <button @click="exportQuestionSet(set)" class="text-green-600 hover:text-green-800" title="এক্সপোর্ট করুন">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                                </svg>
                                            </button>
                                            <button @click="deleteQuestionSet(index)" class="text-red-600 hover:text-red-800" title="মুছুন">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                            <template x-if="savedQuestionSets.length === 0">
                                <tr>
                                    <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">কোন সংরক্ষিত প্রশ্ন সেট নেই</td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button @click="showSavedSetsModal = false" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                        বন্ধ করুন
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ইম্পোর্ট মোডাল -->
    <div x-show="showImportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" x-transition>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md" @click.away="showImportModal = false">
            <div class="p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">প্রশ্ন সেট ইম্পোর্ট করুন</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">প্রশ্ন সেট JSON ডেটা</label>
                        <textarea x-model="importData" rows="8" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="এখানে JSON ডেটা পেস্ট করুন..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button @click="showImportModal = false" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            বাতিল করুন
                        </button>
                        <button @click="importQuestionSet" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            ইম্পোর্ট করুন
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- প্রশ্নপত্র প্রিভিউ মোডাল -->
    <div x-show="showPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto" x-transition>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl my-8" @click.away="showPreviewModal = false">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-medium text-gray-900">প্রশ্নপত্র প্রিভিউ</h3>
                    <div class="flex space-x-3">
                        <button @click="printQuestionPaper" class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" />
                            </svg>
                            প্রিন্ট
                        </button>
                        <button @click="exportQuestionPaper" class="px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            এক্সপোর্ট
                        </button>
                        <button @click="showPreviewModal = false" class="px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm">
                            বন্ধ করুন
                        </button>
                    </div>
                </div>
                
                <div id="questionPaperContent" class="question-paper p-8 bg-white border border-gray-200">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold" x-text="examName || 'পরীক্ষার নাম'"></h2>
                        <p class="mt-2 text-lg" x-text="selectedClass ? selectedClass + ' শ্রেণী' : 'শ্রেণী'"></p>
                        <p class="text-lg" x-text="selectedSubject ? 'বিষয়: ' + selectedSubject : 'বিষয়'"></p>
                        <p class="mt-4" x-text="examDate ? 'তারিখ: ' + formatDate(examDate) : ''"></p>
                        <p x-text="'সময়: ' + (examDuration || '২ ঘন্টা ৩০ মিনিট') + ' | পূর্ণমান: ' + totalMarks"></p>
                    </div>
                    
                    <div class="mb-8" x-show="mcqQuestions.length > 0">
                        <h3 class="text-lg font-semibold mb-3 border-b pb-1">ক-বিভাগ: এমসিকিউ প্রশ্ন</h3>
                        <div class="space-y-4">
                            <template x-for="(question, index) in mcqQuestions" :key="question.id">
                                <div>
                                    <p class="font-medium" x-text="(index + 1) + '. ' + question.text"></p>
                                    <div class="mt-2 ml-6 space-y-1" x-show="question.options && question.options.length > 0">
                                        <template x-for="(option, optIndex) in question.options" :key="optIndex">
                                            <p x-text="String.fromCharCode(97 + optIndex) + ') ' + option"></p>
                                        </template>
                                    </div>
                                    <p class="text-sm text-gray-600 mt-1" x-text="'মান: ' + question.marks"></p>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div x-show="writtenQuestions.length > 0">
                        <h3 class="text-lg font-semibold mb-3 border-b pb-1">খ-বিভাগ: লিখিত প্রশ্ন</h3>
                        <div class="space-y-4">
                            <template x-for="(question, index) in writtenQuestions" :key="question.id">
                                <div>
                                    <p class="font-medium" x-text="(index + 1) + '. ' + question.text"></p>
                                    <p class="text-sm text-gray-600 mt-1" x-text="'মান: ' + question.marks"></p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="mt-12 flex justify-between">
                        <div class="text-center">
                            <div class="border-t-2 border-gray-400 pt-1 w-32 inline-block"></div>
                            <p class="text-sm mt-1">পরীক্ষার্থীর স্বাক্ষর</p>
                        </div>
                        <div class="text-center">
                            <div class="border-t-2 border-gray-400 pt-1 w-32 inline-block"></div>
                            <p class="text-sm mt-1">পরীক্ষকের স্বাক্ষর</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', () => ({
                // ডেটা প্রোপার্টিজ
                classes: ['৬ষ্ঠ শ্রেণী', '৭ম শ্রেণী', '৮ম শ্রেণী', '৯ম শ্রেণী', '১০ম শ্রেণী', 'একাদশ শ্রেণী', 'দ্বাদশ শ্রেণী'],
                subjects: [],
                questions: [],
                selectedQuestions: [],
                savedQuestionSets: [],
                chapters: [],
                
                selectedClass: '',
                selectedSubject: '',
                examName: '',
                examDate: '',
                examDuration: '২ ঘন্টা ৩০ মিনিট',
                filterType: 'all',
                filterChapter: '',
                searchQuery: '',
                
                showAddQuestionModal: false,
                showSavedSetsModal: false,
                showPreviewModal: false,
                showImportModal: false,
                editingQuestion: false,
                importData: '',
                
                newQuestion: {
                    id: null,
                    text: '',
                    type: 'written',
                    marks: 1,
                    chapter: '',
                    options: ['', '', '', '']
                },
                
                // কম্পিউটেড প্রোপার্টিজ
                get filteredQuestions() {
                    let filtered = this.questions;
                    
                    // ক্লাস ও বিষয় ফিল্টার
                    if (this.selectedClass && this.selectedSubject) {
                        filtered = filtered.filter(q => 
                            q.class === this.selectedClass && 
                            q.subject === this.selectedSubject
                        );
                    }
                    
                    // ফিল্টার টাইপ অনুযায়ী
                    if (this.filterType !== 'all') {
                        filtered = filtered.filter(q => q.type === this.filterType);
                    }
                    
                    // অধ্যায় ফিল্টার
                    if (this.filterChapter) {
                        filtered = filtered.filter(q => q.chapter === this.filterChapter);
                    }
                    
                    // সার্চ কুয়েরি অনুযায়ী
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(q => 
                            q.text.toLowerCase().includes(query) || 
                            (q.chapter && q.chapter.toLowerCase().includes(query)) ||
                            (q.options && q.options.some(opt => opt.toLowerCase().includes(query)))
                        );
                    }
                    
                    return filtered;
                },
                
                get totalMarks() {
                    return this.selectedQuestions.reduce((sum, q) => sum + parseInt(q.marks), 0);
                },
                
                get mcqQuestions() {
                    return this.selectedQuestions.filter(q => q.type === 'mcq');
                },
                
                get writtenQuestions() {
                    return this.selectedQuestions.filter(q => q.type === 'written');
                },
                
                // মেথডস
                init() {
                    this.loadSavedQuestionSets();
                    
                    // ডেমো ডেটা - বাস্তবে localStorage থেকে লোড হবে
                    if (localStorage.getItem('madrasa_questions') === null) {
                        this.questions = [
                            {
                                id: 1,
                                text: 'কুরআন মজীদ কোন ভাষায় নাযিল হয়েছে?',
                                type: 'mcq',
                                marks: 1,
                                chapter: 'কুরআন পরিচিতি',
                                class: '৬ষ্ঠ শ্রেণী',
                                subject: 'কুরআন মজীদ',
                                options: ['আরবি', 'ফারসি', 'উর্দু', 'বাংলা']
                            },
                            {
                                id: 2,
                                text: 'সূরা ফাতিহাকে কেন উম্মুল কুরআন বলা হয়?',
                                type: 'written',
                                marks: 5,
                                chapter: 'সূরা ফাতিহা',
                                class: '৬ষ্ঠ শ্রেণী',
                                subject: 'কুরআন মজীদ'
                            },
                            {
                                id: 3,
                                text: 'নিম্নলিখিত কোনটি ইসলামের পঞ্চস্তম্ভের অন্তর্ভুক্ত নয়?',
                                type: 'mcq',
                                marks: 1,
                                chapter: 'ঈমান ও ইসলাম',
                                class: '৭ম শ্রেণী',
                                subject: 'আকাইদ ও ফিকহ',
                                options: ['সালাত', 'সিয়াম', 'যাকাত', 'জিহাদ']
                            },
                            {
                                id: 4,
                                text: 'রাসূল (সা.)-এর জীবনী থেকে আমরা কী শিক্ষা পাই?',
                                type: 'written',
                                marks: 10,
                                chapter: 'সীরাত',
                                class: '৮ম শ্রেণী',
                                subject: 'ইসলামের ইতিহাস'
                            }
                        ];
                        this.saveQuestions();
                    } else {
                        this.questions = JSON.parse(localStorage.getItem('madrasa_questions'));
                    }
                    
                    // অধ্যায় লোড করুন
                    this.loadChapters();
                },
                
                loadSubjects() {
                    // বাস্তবে ক্লাস অনুযায়ী বিষয় লোড করতে হবে
                    if (this.selectedClass) {
                        this.subjects = ['কুরআন মজীদ', 'হাদীস', 'আকাইদ ও ফিকহ', 'আরবি ব্যাকরণ', 'ইসলামের ইতিহাস', 'বাংলা', 'ইংরেজি', 'গণিত'];
                    } else {
                        this.subjects = [];
                    }
                    //this.selectedSubject = '';
                },
                
                loadChapters() {
                    const allChapters = new Set();
                    this.questions.forEach(q => {
                        if (q.chapter) {
                            allChapters.add(q.chapter);
                        }
                    });
                    this.chapters = Array.from(allChapters).sort();
                },
                
                formatQuestionText(text) {
                    return text.replace(/\n/g, '<br>');
                },
                
                formatDate(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('bn-BD', { year: 'numeric', month: 'long', day: 'numeric' });
                },
                
                addToSelected(question) {
                    if (!this.selectedQuestions.some(q => q.id === question.id)) {
                        this.selectedQuestions.push({...question});
                    }
                },
                
                removeFromSelected(index) {
                    this.selectedQuestions.splice(index, 1);
                },
                
                moveQuestionUp(index) {
                    if (index > 0) {
                        const temp = this.selectedQuestions[index];
                        this.selectedQuestions[index] = this.selectedQuestions[index - 1];
                        this.selectedQuestions[index - 1] = temp;
                    }
                },
                
                moveQuestionDown(index) {
                    if (index < this.selectedQuestions.length - 1) {
                        const temp = this.selectedQuestions[index];
                        this.selectedQuestions[index] = this.selectedQuestions[index + 1];
                        this.selectedQuestions[index + 1] = temp;
                    }
                },
                
                editQuestion(question) {
                    this.newQuestion = {
                        id: question.id,
                        text: question.text,
                        type: question.type,
                        marks: question.marks,
                        chapter: question.chapter || '',
                        options: question.options ? [...question.options] : ['', '', '', '']
                    };
                    this.editingQuestion = true;
                    this.showAddQuestionModal = true;
                },
                
                addMcqOption() {
                    this.newQuestion.options.push('');
                },
                
                removeMcqOption(index) {
                    if (this.newQuestion.options.length > 1) {
                        this.newQuestion.options.splice(index, 1);
                    }
                },
                
                saveNewQuestion() {
                    if (!this.newQuestion.text || !this.newQuestion.marks) {
                        alert('প্রশ্ন এবং মান অবশ্যই填写が必要です');
                        return;
                    }
                    
                    if (this.editingQuestion) {
                        // প্রশ্ন আপডেট করুন
                        const index = this.questions.findIndex(q => q.id === this.newQuestion.id);
                        if (index !== -1) {
                            const updatedQuestion = {
                                id: this.newQuestion.id,
                                text: this.newQuestion.text,
                                type: this.newQuestion.type,
                                marks: parseInt(this.newQuestion.marks),
                                chapter: this.newQuestion.chapter,
                                class: this.selectedClass,
                                subject: this.selectedSubject
                            };
                            
                            if (this.newQuestion.type === 'mcq') {
                                updatedQuestion.options = this.newQuestion.options.filter(opt => opt.trim() !== '');
                            }
                            
                            this.questions[index] = updatedQuestion;
                            this.saveQuestions();
                            
                            // নির্বাচিত প্রশ্নও আপডেট করুন যদি থাকে
                            const selectedIndex = this.selectedQuestions.findIndex(q => q.id === this.newQuestion.id);
                            if (selectedIndex !== -1) {
                                this.selectedQuestions[selectedIndex] = {...updatedQuestion};
                            }
                        }
                    } else {
                        // নতুন প্রশ্ন যোগ করুন
                        const newId = this.questions.length > 0 
                            ? Math.max(...this.questions.map(q => q.id)) + 1 
                            : 1;
                        
                        const questionToSave = {
                            id: newId,
                            text: this.newQuestion.text,
                            type: this.newQuestion.type,
                            marks: parseInt(this.newQuestion.marks),
                            chapter: this.newQuestion.chapter,
                            class: this.selectedClass,
                            subject: this.selectedSubject
                        };
                        
                        if (this.newQuestion.type === 'mcq') {
                            questionToSave.options = this.newQuestion.options.filter(opt => opt.trim() !== '');
                        }
                        
                        this.questions.push(questionToSave);
                        this.saveQuestions();
                    }
                    
                    // রিসেট ফর্ম
                    this.newQuestion = {
                        id: null,
                        text: '',
                        type: 'written',
                        marks: 1,
                        chapter: '',
                        options: ['', '', '', '']
                    };
                    
                    this.editingQuestion = false;
                    this.showAddQuestionModal = false;
                    this.loadChapters();
                },
                
                saveQuestions() {
                    localStorage.setItem('madrasa_questions', JSON.stringify(this.questions));
                },
                
                generateQuestionPaper() {
                    if (this.selectedQuestions.length === 0) {
                        alert('কোন প্রশ্ন নির্বাচন করা হয়নি।');
                        return;
                    }
                    
                    if (!this.selectedClass || !this.selectedSubject) {
                        alert('ক্লাস এবং বিষয় নির্বাচন করুন।');
                        return;
                    }
                    
                    this.showPreviewModal = true;
                },
                
                printQuestionPaper() {
                    const printContent = document.getElementById('questionPaperContent').innerHTML;
                    const originalContent = document.body.innerHTML;
                    
                    document.body.innerHTML = `
                        <div class="p-8 question-paper" style="font-family: 'Hind Siliguri', sans-serif;">
                            ${printContent}
                        </div>
                        <style>
                            .question-paper {
                                background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M30,10 L10,10 L10,30" fill="none" stroke="%23e5e7eb" stroke-width="0.5"/><path d="M70,10 L90,10 L90,30" fill="none" stroke="%23e5e7eb" stroke-width="0.5"/><path d="M30,90 L10,90 L10,70" fill="none" stroke="%23e5e7eb" stroke-width="0.5"/><path d="M70,90 L90,90 L90,70" fill="none" stroke="%23e5e7eb" stroke-width="0.5"/></svg>');
                                background-size: 100px 100px;
                            }
                            @page {
                                size: A4;
                                margin: 10mm;
                            }
                            @media print {
                                body {
                                    font-family: 'Hind Siliguri', sans-serif;
                                }
                                .arabic {
                                    font-family: 'Traditional Arabic', 'Lateef', 'Hind Siliguri', sans-serif;
                                }
                            }
                        </style>
                    `;
                    
                    window.print();
                    document.body.innerHTML = originalContent;
                    
                    // Alpine.js কম্পোনেন্ট রি-ইনিশিয়ালাইজ করুন
                    Alpine.initTree(document.body);
                },
                
                exportQuestionPaper() {
                    const questionPaper = {
                        name: this.examName,
                        class: this.selectedClass,
                        subject: this.selectedSubject,
                        date: this.examDate,
                        duration: this.examDuration,
                        totalMarks: this.totalMarks,
                        questions: this.selectedQuestions,
                        createdAt: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(questionPaper, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `${this.selectedClass}_${this.selectedSubject}_${this.examName || 'প্রশ্নপত্র'}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                },
                
                saveQuestionSet() {
                    if (this.selectedQuestions.length === 0) {
                        alert('কোন প্রশ্ন নির্বাচন করা হয়নি।');
                        return;
                    }
                    
                    if (!this.selectedClass || !this.selectedSubject) {
                        alert('ক্লাস এবং বিষয় নির্বাচন করুন।');
                        return;
                    }
                    
                    const setName = prompt('প্রশ্ন সেটের নাম দিন:', this.examName || `${this.selectedClass} ${this.selectedSubject} প্রশ্নপত্র`);
                    
                    if (setName) {
                        const newSet = {
                            id: Date.now(),
                            name: setName,
                            class: this.selectedClass,
                            subject: this.selectedSubject,
                            questions: [...this.selectedQuestions],
                            totalMarks: this.totalMarks,
                            createdAt: new Date().toISOString()
                        };
                        
                        this.savedQuestionSets.push(newSet);
                        this.saveQuestionSetsToLocalStorage();
                    }
                },
                
                loadQuestionSet(set) {
                    this.selectedClass = set.class;
                    this.loadSubjects();
                    this.selectedSubject = set.subject;
                    this.selectedQuestions = [...set.questions];
                    this.examName = set.name;
                    this.showSavedSetsModal = false;
                },
                
                exportQuestionSet(set) {
                    const dataStr = JSON.stringify(set, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `${set.class}_${set.subject}_${set.name}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                },
                
                importQuestionSet() {
                    try {
                        const importedSet = JSON.parse(this.importData);
                        
                        // ভ্যালিডেশন চেক করুন
                        if (!importedSet.name || !importedSet.class || !importedSet.subject || !Array.isArray(importedSet.questions)) {
                            throw new Error('অবৈধ প্রশ্ন সেট ফরম্যাট');
                        }
                        
                        this.savedQuestionSets.push(importedSet);
                        this.saveQuestionSetsToLocalStorage();
                        this.showImportModal = false;
                        this.importData = '';
                        alert('প্রশ্ন সেট সফলভাবে ইম্পোর্ট করা হয়েছে!');
                    } catch (error) {
                        alert('ইম্পোর্ট ব্যর্থ: ' + error.message);
                    }
                },
                
                deleteQuestionSet(index) {
                    if (confirm('আপনি কি এই প্রশ্ন সেট ডিলিট করতে চান?')) {
                        this.savedQuestionSets.splice(index, 1);
                        this.saveQuestionSetsToLocalStorage();
                    }
                },
                
                loadSavedQuestionSets() {
                    const savedSets = localStorage.getItem('madrasa_question_sets');
                    this.savedQuestionSets = savedSets ? JSON.parse(savedSets) : [];
                },
                
                saveQuestionSetsToLocalStorage() {
                    localStorage.setItem('madrasa_question_sets', JSON.stringify(this.savedQuestionSets));
                }
            }));
        });
    </script>
</body>
</html>
